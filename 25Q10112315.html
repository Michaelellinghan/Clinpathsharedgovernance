<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morphology Case 25Q10112315</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .nhs-blue { background-color: #005EB8; }
        .nhs-dark-blue { background-color: #003087; }
        .nhs-text-blue { color: #005EB8; }
        .nhs-text-dark-blue { color: #003087; }
        .results-table { font-size: 0.9rem; }
        .results-table td { padding: 0.25rem 0.5rem; border-bottom: 1px solid #e5e7eb; }
        .results-table tr:last-child td { border-bottom: none; }
        .feature-checkbox:disabled { opacity: 0.7; }
        .feature-label:has(.feature-checkbox:disabled) { cursor: not-allowed; color: #6b7280; }
        .highlight-correct { background-color: #dcfce7; color: #166534; }
        /* Modal Styles */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.85); align-items: center; justify-content: center; }
        .modal-content { margin: auto; display: block; max-width: 85%; max-height: 85%; transition: transform 0.2s ease; cursor: zoom-in; }
        .modal-content.zoomed { transform: scale(2); cursor: zoom-out; }
        .modal-close { position: absolute; top: 15px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; transition: 0.3s; cursor: pointer; }
        .modal-nav { cursor: pointer; position: absolute; top: 50%; width: auto; padding: 16px; margin-top: -22px; color: white; font-weight: bold; font-size: 20px; transition: 0.3s ease; user-select: none; background-color: rgba(0,0,0,0.3); }
        .modal-nav:hover { background-color: rgba(0,0,0,0.8); }
        .modal-prev { left: 0; border-radius: 0 3px 3px 0; }
        .modal-next { right: 0; border-radius: 3px 0 0 3px; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

        <div id="header-placeholder"></div>

    <main class="py-16">
        <div class="container mx-auto px-6 max-w-7xl">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold nhs-text-dark-blue">Morphology Case Library</h2>
                <p class="text-lg text-gray-600">Case Study: 25Q10112315</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="space-y-6">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-2xl font-semibold nhs-text-dark-blue border-b pb-2 mb-4">Case Information</h3>
                        <div id="initial-info">
                            <p><strong>Patient:</strong> 78-year-old female.</p>
                            <p><strong>Clinical Details:</strong> Tired all the time.</p>
                             <h4 class="font-bold mt-4">Initial Full Blood Count</h4>
                            <table class="w-full results-table mt-2">
                                <tr><td>WBC</td><td class="font-mono text-right">57.95 x10⁹/L</td></tr>
                                <tr><td>RBC</td><td class="font-mono text-right">2.46 x10¹²/L</td></tr>
                                <tr><td>HGB</td><td class="font-mono text-right">75 g/L</td></tr>
                                <tr><td>HCT</td><td class="font-mono text-right">0.231 L/L</td></tr>
                                <tr><td>MCV</td><td class="font-mono text-right">93.9 fL</td></tr>
                                <tr><td>MCH</td><td class="font-mono text-right">30.5 pg</td></tr>
                                <tr><td>MCHC</td><td class="font-mono text-right">325 g/L</td></tr>
                                <tr><td>PLT</td><td class="font-mono text-right">73 x10⁹/L</td></tr>
                                <tr><td>RDW-CV</td><td class="font-mono text-right">19.9 %</td></tr>
                                <tr><td>NRBC</td><td class="font-mono text-right">0.85 x10⁹/L</td></tr>
                            </table>
                            <p class="text-sm text-red-600 font-semibold mt-2">Automated Differential failed as analyser unable to differentiate cells.</p>
                        </div>
                        <div id="full-case-details" class="hidden mt-4 pt-4 border-t">
                            <h4 class="font-bold">Manual Differential (Post-Morphology)</h4>
                             <table class="w-full results-table mt-2">
                                <tr><td>Neutrophils</td><td class="font-mono text-right">3.51%</td></tr>
                                <tr><td>Lymphocytes</td><td class="font-mono text-right">9.65%</td></tr>
                                <tr><td>Monocytes</td><td class="font-mono text-right">0.88%</td></tr>
                                <tr><td>Eosinophils</td><td class="font-mono text-right">0.00%</td></tr>
                                <tr><td>Basophils</td><td class="font-mono text-right">0.00%</td></tr>
                                <tr><td class="font-bold">Blasts</td><td class="font-mono text-right font-bold">85.96%</td></tr>
                            </table>
                             <div class="space-y-4 mt-4">
                                <h4 class="font-bold">Sysmex Scatterplot Analysis</h4>
                                 <img src="morphology/25Q10112315/WDF.PNG" alt="WDF Scatterplot" class="rounded-md w-full h-auto mt-2 shadow">
                                  <p class="text-sm mt-2"><b>WDF (White Cell Differential) Scatterplot:</b> This plot is overwhelmed by a massive, undifferentiated, grey-coloured population in the left half. This is the normal areas for lymphocytes and monocytes.</p>
                                  <img src="morphology/25Q10112315/WNR.PNG" alt="WNR Scatterplot" class="rounded-md w-full h-auto mt-2 shadow">
                                    <p class="text-sm mt-2"><b>WNR (White Cell Nucleated Red Cell) Scatterplot:</b> This plot clearly shows two distinct populations. The dominant cluster is on the left, confirming the vast majority of nucleated cells are leucocytes. A smaller but significant secondary cluster is visible in the NRBC area on the right, confirming the numerical NRBC count of 0.85 x10⁹/L.</p>
                                   <img src="morphology/25Q10112315/WPC.PNG" alt="WPC Scatterplot" class="rounded-md w-full h-auto mt-2 shadow">
                                    <p class="text-sm mt-2"><b>WPC (White Precursor Cell) Scatterplot:</b> This specialised plot gives a very clear and alarming signal. The events are almost exclusively located in a tight cluster in the upper 'blast' region. This provides a high-confidence flag that the sample contains a large, homogenous population of pathological precursor cells, strongly supporting a diagnosis of acute leukaemia.</p>
                                    <img src="morphology/25Q10112315/WPC(SCC-FSC).PNG" alt="WPC(SCC-FSC) Scatterplot" class="rounded-md w-full h-auto mt-2 shadow">
                                    <p class="text-sm mt-2"><b>WPC (SSC-FSC) Scatterplot:</b> This plot shows the blast population has low internal complexity (low SSC), typical for agranular blasts, and a relatively uniform size (tight FSC distribution). This homogeneity is another feature often seen in acute leukaemia where a single malignant clone has proliferated.</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-2xl font-semibold nhs-text-dark-blue border-b pb-2 mb-4">Blood Film Examination</h3>
                        <div class="mb-6">
                            <h4 class="font-semibold text-lg">Red Cell Picture</h4>
                            <div id="red-cell-container" class="cursor-pointer">
                                <img id="red-cell-img" src="morphology/25Q10112315/red cells.PNG" alt="Overall red cell picture for case" class="rounded-md w-full h-auto mt-2 shadow">
                            </div>
                        </div>
                        <div>
                             <h4 class="font-semibold text-lg">White Cell Gallery</h4>
                             <p class="text-sm text-gray-600 mb-2">Click a thumbnail to view the full-size image.</p>
                             <div id="wbc-gallery" class="grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-2 max-h-96 overflow-y-auto pr-2">
                                 </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-2xl font-semibold nhs-text-dark-blue border-b pb-2 mb-4">Morphology Checklist</h3>
                    <p class="text-gray-600 mb-4">Select up to five key morphological features you have identified.</p>
                    
                    <div id="feature-checklist" class="space-y-4 max-h-96 overflow-y-auto pr-2">
                        </div>

                    <button id="reveal-btn" class="w-full mt-6 bg-black text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-800 transition duration-300">See Results</button>

                    <div id="analysis-section" class="hidden mt-6 border-t pt-6">
                        <h3 class="text-2xl font-semibold nhs-text-dark-blue mb-4">Analysis & Peer Consensus</h3>
                        
                        <div class="mb-6">
                            <h4 class="text-lg font-bold">Your Selected Features:</h4>
                            <ul id="user-choices" class="list-disc list-inside mt-2"></ul>
                        </div>
                        
                        <div class="mb-6">
                            <h4 class="text-lg font-bold">Expert Commentary</h4>
                            <div class="mt-2 p-4 bg-gray-100 rounded-md text-gray-700">
                                <p id="expert-comment-text" class="whitespace-pre-wrap"></p>
                            </div>
                        </div>

                        <div>
                            <h4 class="text-lg font-bold">Top Features</h4>
                            <table class="w-full text-left mt-2 text-sm">
                                <thead>
                                    <tr class="bg-gray-50"><th class="p-2">Feature</th><th
                                </thead>
                                <tbody id="top-features-table"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                                        <section class="text-center mt-12">
                <a href="morphology_cases.html" class="bg-gray-800 text-white font-bold py-3 px-8 rounded-full hover:bg-gray-700 transition duration-300">
                    <i class="fas fa-arrow-left mr-2"></i>Back to More Cases
                </a>
            </section>
    </main>

    <div id="image-modal" class="modal">
        <span class="modal-close" id="modal-close-btn">&times;</span>
        <a class="modal-prev modal-nav" id="modal-prev-btn">&#10094;</a>
        <a class="modal-next modal-nav" id="modal-next-btn">&#10095;</a>
        <img class="modal-content" id="modal-img">
    </div>

    <div id="footer-placeholder"></div>

      <script src="js/component-loader.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            feather.replace();
        });
   </script>
    
<script>
    function checkMorphology() {
        const correctFeatures = ["Acanthocytes", "Target cells", "Polychromasia", "Macrocytosis", "Howell-Jolly bodies"];
        const checkboxes = document.querySelectorAll('#morphology-checklist input[type="checkbox"]:checked');
        const selectedFeatures = Array.from(checkboxes).map(cb => cb.value);
        const resultContainer = document.getElementById('results'); // Corrected from 'result' to 'results'

        let score = 0;
        let correctSelections = [];
        let incorrectSelections = [];

        // Check selected features against the correct list
        selectedFeatures.forEach(feature => {
            if (correctFeatures.includes(feature)) {
                score++;
                correctSelections.push(feature);
            } else {
                incorrectSelections.push(feature);
            }
        });

        // Penalise for missed correct features
        const missedFeatures = correctFeatures.filter(f => !selectedFeatures.includes(f));

        let resultHTML = `<h3>Results</h3>`;
        resultHTML += `<p>You correctly identified ${correctSelections.length} out of 5 features.</p>`;

        if (correctSelections.length > 0) {
            resultHTML += `<p><strong>Correctly identified:</strong> ${correctSelections.join(', ')}</p>`;
        }
        if (incorrectSelections.length > 0) {
            resultHTML += `<p><strong>Incorrectly identified:</strong> ${incorrectSelections.join(', ')}</p>`;
        }
        if (missedFeatures.length > 0) {
            resultHTML += `<p><strong>Missed features:</strong> ${missedFeatures.join(', ')}</p>`;
        }

        // Display final score and feedback
        if (score === 5 && selectedFeatures.length === 5) {
            resultHTML += `<p style="color: green;"><strong>Excellent! You identified all the key morphological features.</strong></p>`;
        } else {
            resultHTML += `<p style="color: orange;"><strong>You're on the right track! Review the missed or incorrectly identified features and try again.</strong></p>`;
        }

        resultContainer.innerHTML = resultHTML;
    }

    // This part limits the number of selectable checkboxes to 5
    const checklist = document.getElementById('morphology-checklist');
    checklist.addEventListener('change', function(e) {
        const checkedCheckboxes = checklist.querySelectorAll('input[type="checkbox"]:checked');
        if (checkedCheckboxes.length > 5) {
            alert('You can select up to five features only.');
            e.target.checked = false;
        }
    });
</script>

</body>
</html>
