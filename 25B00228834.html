<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morphology Case 25B00228834</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .nhs-blue { background-color: #005EB8; }
        .nhs-dark-blue { background-color: #003087; }
        .nhs-text-blue { color: #005EB8; }
        .nhs-text-dark-blue { color: #003087; }
        .results-table { font-size: 0.9rem; }
        .results-table td { padding: 0.25rem 0.5rem; border-bottom: 1px solid #e5e7eb; }
        .results-table tr:last-child td { border-bottom: none; }
        .feature-checkbox:disabled { opacity: 0.7; }
        .feature-label:has(.feature-checkbox:disabled) { cursor: not-allowed; color: #6b7280; }
        .highlight-correct { background-color: #dcfce7; color: #166534; }
        .highlight-abnormal { background-color: #fee2e2; }
        /* Modal Styles */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.85); align-items: center; justify-content: center; }
        .modal-content { margin: auto; display: block; max-width: 85%; max-height: 85%; transition: transform 0.2s ease; cursor: zoom-in; }
        .modal-content.zoomed { transform: scale(2); cursor: zoom-out; }
        .modal-close { position: absolute; top: 15px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; transition: 0.3s; cursor: pointer; }
        .modal-nav { cursor: pointer; position: absolute; top: 50%; width: auto; padding: 16px; margin-top: -22px; color: white; font-weight: bold; font-size: 20px; transition: 0.3s ease; user-select: none; background-color: rgba(0,0,0,0.3); }
        .modal-nav:hover { background-color: rgba(0,0,0,0.8); }
        .modal-prev { left: 0; border-radius: 0 3px 3px 0; }
        .modal-next { right: 0; border-radius: 3px 0 0 3px; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

        <div id="header-placeholder"></div>

    <main class="py-16">
        <div class="container mx-auto px-6 max-w-7xl">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold nhs-text-dark-blue">Morphology Case Library</h2>
                <p class="text-lg text-gray-600">Case Study: 25B00228834</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="space-y-6">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-2xl font-semibold nhs-text-dark-blue border-b pb-2 mb-4">Case Information</h3>
                        <div id="initial-info">
                            <p><strong>Patient:</strong> 18-year-old male.</p>
                             <h4 class="font-bold mt-4">Full Blood Count</h4>
                            <table class="w-full results-table mt-2">
                                <tr><td>WBC</td><td class="font-mono text-right">5.95 x10⁹/L</td></tr>
                                <tr><td>RBC</td><td class="font-mono text-right">5.09 x10¹²/L</td></tr>
                                <tr><td>HGB</td><td class="font-mono text-right">162 g/L</td></tr>
                                <tr><td>HCT</td><td class="font-mono text-right">0.448 L/L</td></tr>
                                <tr><td>MCV</td><td class="font-mono text-right">88.0 fL</td></tr>
                                <tr><td>MCH</td><td class="font-mono text-right">31.8 pg</td></tr>
                                <tr><td>MCHC</td><td class="font-mono text-right">362 g/L</td></tr>
                                <tr><td>PLT</td><td class="font-mono text-right">167 x10⁹/L</td></tr>
                                <tr><td>MPV</td><td class="font-mono text-right">10.7 fL</td></tr>
                                <tr><td>RDW-CV</td><td class="font-mono text-right">14.0 %</td></tr>
                                <tr><td>NRBC</td><td class="font-mono text-right">0.00 x10⁹/L</td></tr>
                                <tr><td>Reticulocyte</td><td class="font-mono text-right">201.10 x10⁹/L</td></tr>
                            </table>
                             <h4 class="font-bold mt-4">Automated Differential</h4>
                             <table class="w-full results-table mt-2">
                                <tr><td>Neutrophils</td><td class="font-mono text-right">4.34 x10⁹/L (73%)</td></tr>
                                <tr><td>Lymphocytes</td><td class="font-mono text-right">1.08 x10⁹/L (18.2%)</td></tr>
                                <tr><td>Monocytes</td><td class="font-mono text-right">0.36 x10⁹/L (6.1%)</td></tr>
                                <tr><td>Eosinophils</td><td class="font-mono text-right">0.09 x10⁹/L (1.5%)</td></tr>
                                <tr><td>Basophils</td><td class="font-mono text-right">0.07 x10⁹/L (1.2%)</td></tr>
                            </table>
                        </div>
                        <div id="full-case-details" class="hidden mt-4 pt-4 border-t">
                             <div class="space-y-4 mt-4">
                                <h4 class="font-bold">Biochemistry Results</h4>
                                 <table class="w-full results-table mt-2">
                                <tr><td>Sodium</td><td class="font-mono text-right">142 mmol/L</td></tr>
                                <tr><td>Potassium</td><td class="font-mono text-right">4.0 mmol/L</td></tr>
                                <tr><td>Urea</td><td class="font-mono text-right">5.4 mmol/L</td></tr>
                                <tr><td>Creatinine</td><td class="font-mono text-right">68 umol/L</td></tr>
                                <tr><td>eGFR</td><td class="font-mono text-right">>90 mL/min/1.73m*2</td></tr>
                                 <tr id="alt-result"><td>ALT</td><td class="font-mono text-right">38 U/L</td></tr>
                                 <tr id="bilirubin-result"><td>Total Bilirubin</td><td class="font-mono text-right">44 umol/L</td></tr>
                                 <tr><td>ALP</td><td class="font-mono text-right">74 U/L</td></tr>
                                 <tr><td>Adjusted Calcium</td><td class="font-mono text-right">2.30 mmol/L</td></tr>
                                <tr id="albumin-result"><td>Albumin</td><td class="font-mono text-right">52 g/L</td></tr>
                                <tr><td>Phosphate</td><td class="font-mono text-right">0.97 mmol/L</td></tr>
                                 <tr><td>Lactate Dehydrogenase</td><td class="font-mono text-right">218 U/L</td></tr>
                            </table>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-2xl font-semibold nhs-text-dark-blue border-b pb-2 mb-4">Blood Film Examination</h3>
                        <div class="mb-6">
                            <h4 class="font-semibold text-lg">Red Cell Picture</h4>
                            <div id="red-cell-container" class="cursor-pointer">
                                <img id="red-cell-img" src="morphology/25B00228834/25B00228834 Red cells.png" alt="Overall red cell picture for case" class="rounded-md w-full h-auto mt-2 shadow">
                            </div>
                        </div>
                        <div>
                             <h4 class="font-semibold text-lg">White Cell Gallery</h4>
                             <p class="text-sm text-gray-600 mb-2">Click a thumbnail to view the full-size image.</p>
                             <div id="wbc-gallery" class="grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-2 max-h-96 overflow-y-auto pr-2">
                                 </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-2xl font-semibold nhs-text-dark-blue border-b pb-2 mb-4">Morphology Checklist</h3>
                    <p class="text-gray-600 mb-4">Select the key morphological feature you have identified.</p>
                    
                    <div id="feature-checklist" class="space-y-4 max-h-96 overflow-y-auto pr-2">
                        </div>

                    <button id="reveal-btn" onclick="checkMorphology()" class="w-full mt-6 bg-black text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-800 transition duration-300">See Results</button>
                    
                    <div id="results" class="mt-4"></div>

                    <div id="analysis-section" class="hidden mt-6 border-t pt-6">
                        <h3 class="text-2xl font-semibold nhs-text-dark-blue mb-4">Analysis & Peer Consensus</h3>
                        
                        <div class="mb-6">
                            <h4 class="text-lg font-bold">Your Selected Features:</h4>
                            <ul id="user-choices" class="list-disc list-inside mt-2"></ul>
                        </div>
                        
                        <div class="mb-6">
                            <h4 class="text-lg font-bold">Expert Commentary</h4>
                            <div class="mt-2 p-4 bg-gray-100 rounded-md text-gray-700">
                                <p id="expert-comment-text" class="whitespace-pre-wrap"></p>
                            </div>
                        </div>

                        <div>
                            <h4 class="text-lg font-bold">Top Features</h4>
                            <table class="w-full text-left mt-2 text-sm">
                                <thead>
                                    <tr class="bg-gray-50"><th class="p-2">Feature</th><th
                                </thead>
                                <tbody id="top-features-table"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                                        <section class="text-center mt-12">
                <a href="morphology_cases.html" class="bg-gray-800 text-white font-bold py-3 px-8 rounded-full hover:bg-gray-700 transition duration-300">
                    <i class="fas fa-arrow-left mr-2"></i>Back to More Cases
                </a>
            </section>
    </main>

    <div id="image-modal" class="modal">
        <span class="modal-close" id="modal-close-btn">&times;</span>
        <a class="modal-prev modal-nav" id="modal-prev-btn">&#10094;</a>
        <a class="modal-next modal-nav" id="modal-next-btn">&#10095;</a>
        <img class="modal-content" id="modal-img">
    </div>

    <div id="footer-placeholder"></div>

      <script src="js/component-loader.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            feather.replace();
        });
   </script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Initialise Feather Icons ---
            feather.replace();

            // --- Page Data for Case ---
            const imageFilenames = ["BA_630280.jpg", "BA_630318.jpg", "BNE_630254.jpg", "BNE_630268.jpg", "BNE_630272.jpg", "BNE_630294.jpg", "BNE_630361.jpg", "BNE_630369.jpg", "BNE_630440.jpg", "BNE_630442.jpg", "LY_630269.jpg", "LY_630279.jpg", "LY_630285.jpg", "LY_630286.jpg", "LY_630295.jpg", "LY_630328.jpg", "LY_630338.jpg", "LY_630349.jpg", "LY_630350.jpg", "LY_630358.jpg", "LY_630364.jpg", "LY_630372.jpg", "LY_630384.jpg", "LY_630386.jpg", "LY_630405.jpg", "LY_630413.jpg", "LY_630414.jpg", "LY_630416.jpg", "MO_630259.jpg", "MO_630322.jpg", "MO_630330.jpg", "MO_630368.jpg", "MO_630387.jpg", "MY_630257.jpg", "SNE_630255.jpg", "SNE_630256.jpg", "SNE_630258.jpg", "SNE_630260.jpg", "SNE_630261.jpg", "SNE_630262.jpg", "SNE_630270.jpg", "SNE_630271.jpg", "SNE_630278.jpg", "SNE_630281.jpg", "SNE_630282.jpg", "SNE_630283.jpg", "SNE_630284.jpg", "SNE_630287.jpg", "SNE_630293.jpg", "SNE_630296.jpg", "SNE_630297.jpg", "SNE_630308.jpg", "SNE_630310.jpg", "SNE_630311.jpg", "SNE_630312.jpg", "SNE_630319.jpg", "SNE_630320.jpg", "SNE_630321.jpg", "SNE_630329.jpg", "SNE_630331.jpg", "SNE_630332.jpg", "SNE_630339.jpg", "SNE_630340.jpg", "SNE_630341.jpg", "SNE_630342.jpg", "SNE_630348.jpg", "SNE_630351.jpg", "SNE_630352.jpg", "SNE_630359.jpg", "SNE_630360.jpg", "SNE_630362.jpg", "SNE_630363.jpg", "SNE_630365.jpg", "SNE_630366.jpg", "SNE_630367.jpg", "SNE_630370.jpg", "SNE_630371.jpg", "SNE_630383.jpg", "SNE_630385.jpg", "SNE_630393.jpg", "SNE_630394.jpg", "SNE_630395.jpg", "SNE_630396.jpg", "SNE_630403.jpg", "SNE_630404.jpg", "SNE_630406.jpg", "SNE_630412.jpg", "SNE_630415.jpg", "SNE_630427.jpg", "SNE_630428.jpg", "SNE_630429.jpg", "SNE_630430.jpg", "SNE_630431.jpg", "SNE_630437.jpg", "SNE_630438.jpg", "SNE_630439.jpg", "SNE_630441.jpg", "SNE_630443.jpg", "UI_630309.jpg", "VLY_630397.jpg"];
            const expertComment = "The blood film shows prominent acanthocytes, which are spiculated red cells with irregular, blunt-ended projections. This morphology, in conjunction with the patient's age and sex, is highly suggestive of McLeod Syndrome. \n\nMcLeod Syndrome is a rare, X-linked genetic disorder caused by a mutation in the XK gene. This gene codes for the Kx blood group antigen. The absence of the Kx antigen leads to a weakened expression of the Kell blood group antigens, resulting in the characteristic McLeod phenotype. Diagnosis is confirmed by demonstrating the absence of Kx antigen and weakened Kell antigens on the patient's red cells, and can be confirmed by genetic testing for a mutation in the XK gene.\n\nHaematologically, patients with McLeod syndrome typically have a compensated haemolytic anaemia, with acanthocytosis being a key diagnostic feature. The reticulocytosis and raised bilirubin seen here are consistent with this. Although the patient's FBC is otherwise unremarkable, the presence of acanthocytes should always prompt further investigation for underlying neurological or systemic disease. McLeod syndrome is a progressive disorder that can affect the nervous system, muscles, and heart. Therefore, early diagnosis is crucial for appropriate management and genetic counselling. \n\nFrom a blood transfusion perspective, patients with the McLeod phenotype are considered to have a rare blood type. They can form anti-Kx and other antibodies against Kell system antigens if transfused with normal blood. Therefore, it is essential that these patients receive Kx-negative blood, which is extremely rare. It is recommended that individuals with McLeod syndrome donate their own blood for autologous transfusion if they are likely to require it in the future.";
            
            const topPeerFeatures = [
                {"feature":"Acanthocytes"},
            ];

            const morphologyFeatures = {"Red Cell Features":["Anaemia","Microcytes","Hypochromic Cells","Polychromatic Cells","Mixed Cell Population (Dimorphic)","Poikilocytes","Target Cells","Echinocytes/Crenated Cells","Fragments/Schistocytes","Sickle Cells","Spherocytes","Rouleaux","Basophilic Stippling","Nucleated RBCs","Acanthocytes","Tear Drop Poikilocytes","Keratocytes/Bite Cells","Boat-shaped Cells","Howell-Jolly Bodies"],"White Cell Features":["Leukocytosis","Eosinophilia","Band Form Neutrophils","Toxic Granulation","Hypogranular/Agranular Cytoplasm (Neutrophils)","Blast Cells","Promyelocytes","Prolymphocytes","Myelocytes","Smear/Smudge Cells","Atypical/Suspect Reactive Lymphocytes","Reactive/Plasmacytoid Lymphocytes","Cleft Nuclei","Plasma Cells","Auer Rods","Basophilia","Neutropenia","Lymphocytosis","Lymphopenia","Abnormal/Suspect Neoplastic Lymphocytes","Large Granular Lymphocytes","Left Shift","Pseudo-Pelger Cells","Promonocytes"],"Platelet Features":["Thrombocytosis","Thrombocytopenia","Large/Giant Platelets","Platelet Anisocytosis","Platelet Clumps"]};
            
            // --- UI Element References ---
            const checklistContainer = document.getElementById('feature-checklist');
            const galleryContainer = document.getElementById('wbc-gallery');
            const revealBtn = document.getElementById('reveal-btn');
            const analysisSection = document.getElementById('analysis-section');
            const fullDetailsSection = document.getElementById('full-case-details');
            const modal = document.getElementById('image-modal');
            const modalImg = document.getElementById('modal-img');
            const closeModalBtn = document.getElementById('modal-close-btn');
            const prevBtn = document.getElementById('modal-prev-btn');
            const nextBtn = document.getElementById('modal-next-btn');
            const redCellContainer = document.getElementById('red-cell-container');

            let currentImageIndex = 0;
            const imagePath = 'morphology/25B00228834/';
            const allGalleryImages = [document.getElementById('red-cell-img').src, ...imageFilenames.map(name => imagePath + name)];

            // --- UI Population ---
            for (const category in morphologyFeatures) {
                let categoryHtml = `<h4 class="font-bold mt-4 text-gray-700">${category}</h4>`;
                morphologyFeatures[category].forEach(feature => {
                    categoryHtml += `<label class="feature-label flex items-center space-x-3 cursor-pointer"><input type="checkbox" value="${feature}" class="feature-checkbox h-5 w-5 rounded border-gray-300 text-nhs-blue focus:ring-nhs-blue" data-feature="${feature}"><span>${feature}</span></label>`;
                });
                checklistContainer.innerHTML += categoryHtml;
            }


            imageFilenames.forEach(filename => {
                const img = document.createElement('img');
                img.src = imagePath + filename;
                img.alt = `Morphology image: ${filename}`;
                img.className = 'w-full h-auto rounded cursor-pointer hover:opacity-75 transition-opacity';
                galleryContainer.appendChild(img);
            });
            
            // --- Event Logic ---
            const openModal = (startIndex) => {
                currentImageIndex = startIndex;
                modal.style.display = "flex";
                modalImg.src = allGalleryImages[currentImageIndex];
                modalImg.classList.remove('zoomed');
            };

            const showImage = (newIndex) => {
                currentImageIndex = (newIndex + allGalleryImages.length) % allGalleryImages.length;
                modalImg.src = allGalleryImages[currentImageIndex];
                modalImg.classList.remove('zoomed');
            };
            
            redCellContainer.addEventListener('click', () => openModal(0));
            
            Array.from(galleryContainer.children).forEach((thumb, index) => {
                thumb.addEventListener('click', () => openModal(index + 1)); // +1 to account for red cell image at index 0
            });

            prevBtn.addEventListener('click', (e) => { e.stopPropagation(); showImage(currentImageIndex - 1); });
            nextBtn.addEventListener('click', (e) => { e.stopPropagation(); showImage(currentImageIndex + 1); });
            closeModalBtn.onclick = () => { modal.style.display = "none"; };
            modal.addEventListener('click', (e) => { if (e.target === modal) modal.style.display = "none"; });
            modalImg.addEventListener('click', (e) => { e.stopPropagation(); e.target.classList.toggle('zoomed'); });

        });

        function checkMorphology() {
            const correctFeatures = ["Acanthocytes"];
            const checkboxes = document.querySelectorAll('#feature-checklist input[type="checkbox"]:checked');
            const selectedFeatures = Array.from(checkboxes).map(cb => cb.value);
            const resultContainer = document.getElementById('results');

            let score = 0;
            let correctSelections = [];
            let incorrectSelections = [];

            // Check selected features against the correct list
            selectedFeatures.forEach(feature => {
                if (correctFeatures.includes(feature)) {
                    score++;
                    correctSelections.push(feature);
                } else {
                    incorrectSelections.push(feature);
                }
            });

            const missedFeatures = correctFeatures.filter(f => !selectedFeatures.includes(f));

            let resultHTML = `<h3>Results</h3>`;
            resultHTML += `<p>You correctly identified ${correctSelections.length} out of 1 feature.</p>`;

            if (correctSelections.length > 0) {
                resultHTML += `<p><strong>Correctly identified:</strong> ${correctSelections.join(', ')}</p>`;
            }
            if (incorrectSelections.length > 0) {
                resultHTML += `<p><strong>Incorrectly identified:</strong> ${incorrectSelections.join(', ')}</p>`;
            }
            if (missedFeatures.length > 0) {
                resultHTML += `<p><strong>Missed features:</strong> ${missedFeatures.join(', ')}</p>`;
            }

            // Display final score and feedback
            if (score === 1 && selectedFeatures.length === 1) {
                resultHTML += `<p style="color: green;"><strong>Excellent! You identified the key morphological feature.</strong></p>`;
            } else {
                resultHTML += `<p style="color: orange;"><strong>Review the film and try to identify the correct feature.</strong></p>`;
            }

            resultContainer.innerHTML = resultHTML;

            // Also reveal the analysis section
            document.getElementById('analysis-section').classList.remove('hidden');
            document.getElementById('full-case-details').classList.remove('hidden');
            document.getElementById('reveal-btn').disabled = true;
            document.getElementById('reveal-btn').classList.add('opacity-50', 'cursor-not-allowed');
            document.querySelectorAll('.feature-checkbox').forEach(cb => cb.disabled = true);
            document.getElementById('user-choices').innerHTML = selectedFeatures.length > 0 ? selectedFeatures.map(choice => `<li>${choice}</li>`).join('') : '<li>No features selected.</li>';
            document.getElementById('expert-comment-text').textContent = "The blood film shows prominent acanthocytes, which are spiculated red cells with irregular, blunt-ended projections. This morphology, in conjunction with the patient's age and sex, is highly suggestive of McLeod Syndrome. \n\nMcLeod Syndrome is a rare, X-linked genetic disorder caused by a mutation in the XK gene. This gene codes for the Kx blood group antigen. The absence of the Kx antigen leads to a weakened expression of the Kell blood group antigens, resulting in the characteristic McLeod phenotype. Diagnosis is confirmed by demonstrating the absence of Kx antigen and weakened Kell antigens on the patient's red cells, and can be confirmed by genetic testing for a mutation in the XK gene.\n\nHaematologically, patients with McLeod syndrome typically have a compensated haemolytic anaemia, with acanthocytosis being a key diagnostic feature. The reticulocytosis and raised bilirubin seen here are consistent with this. Although the patient's FBC is otherwise unremarkable, the presence of acanthocytes should always prompt further investigation for underlying neurological or systemic disease. McLeod syndrome is a progressive disorder that can affect the nervous system, muscles, and heart. Therefore, early diagnosis is crucial for appropriate management and genetic counselling. \n\nFrom a blood transfusion perspective, patients with the McLeod phenotype are considered to have a rare blood type. They can form anti-Kx and other antibodies against Kell system antigens if transfused with normal blood. Therefore, it is essential that these patients receive Kx-negative blood, which is extremely rare. It is recommended that individuals with McLeod syndrome donate their own blood for autologous transfusion if they are likely to require it in the future.";
            
            const topFeaturesTable = document.getElementById('top-features-table');
            const topPeerFeatures = [
                {"feature":"Acanthocytes"},
            ];
            topFeaturesTable.innerHTML = topPeerFeatures.map(f => {
                const isUserChoice = selectedFeatures.includes(f.feature);
                return `<tr class="${isUserChoice ? 'highlight-correct font-bold' : ''}"><td class="p-2">${f.feature}</td></tr>`;
            }).join('');

            // Highlight abnormal results
            document.getElementById('alt-result').classList.add('highlight-abnormal');
            document.getElementById('bilirubin-result').classList.add('highlight-abnormal');
            document.getElementById('albumin-result').classList.add('highlight-abnormal');
            document.querySelector('.results-table tr:last-child').classList.add('highlight-abnormal');

        }

    </script>

</body>
</html>
