<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patho-Word - Clinical Pathology</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <style>
        .tile {
            width: 60px;
            height: 60px;
            font-size: 2rem;
            font-weight: bold;
            text-transform: uppercase;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            border: 2px solid #d1d5db;
            transition: transform 0.6s, background-color 0.3s, border-color 0.3s;
        }
        .tile.flip {
            transform: rotateX(360deg);
        }
        .tile.correct {
            background-color: #22c55e; /* green-500 */
            border-color: #16a34a; /* green-600 */
            color: white;
        }
        .tile.present {
            background-color: #f59e0b; /* amber-500 */
            border-color: #b45309; /* amber-700 */
            color: white;
        }
        .tile.absent {
            background-color: #6b7280; /* gray-500 */
            border-color: #4b5563; /* gray-600 */
            color: white;
        }
        .keyboard-key {
            transition: background-color 0.2s ease;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex flex-col min-h-screen">

    <div id="header-placeholder"></div>

    <main class="container mx-auto px-4 py-8 flex-grow">
        <section class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold mb-2">Patho-Word</h1>
            <p class="text-lg text-gray-600">Guess the pathology-related word!</p>
        </section>

        <div id="game-container" class="max-w-md mx-auto">
            <div id="grid-container" class="grid gap-1 mb-6">
                </div>
            <div id="keyboard-container" class="flex flex-col gap-1">
                </div>
        </div>
    </main>
    
    <div id="message-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-xl p-6 text-center">
            <p id="message-text" class="text-xl font-semibold mb-4"></p>
            <button id="reset-button" class="bg-blue-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-600">Play Again</button>
        </div>
    </div>


    <div id="footer-placeholder"></div>
    <script src="js/component-loader.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const wordList = [
                'CELL', 'GENE', 'VIAL', 'SLIDE', 'ASSAY', 'PULSE', 'VEIN', 'CLOT',
                'ACID', 'BASE', 'GRAM', 'HBV', 'HCV',
                'BLOOD', 'SERUM', 'PLASMA', 'AGENT', 'VIRUS', 'ORGAN', 'TISSUE',
                'STAIN', 'SMEAR', 'COUNT', 'PLATE', 'PUMP', 'LYSE', 'NEON',
                'GENOME', 'ENZYME', 'FUNGUS', 'BUFFER', 'SPLEEN', 'KIDNEY',
                'THYMUS', 'MUTATE', 'BIOPSY', 'CULTURE', 'HEPARIN', 'CITRATE',
                'PATHOGEN', 'LEUKAEMIA', 'ANAEMIA', 'ANTIBODY', 'ANTIGEN', 'DISEASE',
                'MALARIA', 'MYELOMA', 'THROMBIN', 'FIBRIN', 'EOSIN', 'BASOPHIL',
                'HAEMATOLOGY', 'CHEMISTRY', 'HISTOLOGY', 'CYTOLOGY', 'VIROLOGY', 'IMMUNOLOGY'
            ];

            const gridContainer = document.getElementById('grid-container');
            const keyboardContainer = document.getElementById('keyboard-container');
            const modal = document.getElementById('message-modal');
            const messageText = document.getElementById('message-text');
            const resetButton = document.getElementById('reset-button');
            
            const GUESS_COUNT = 6;
            let WORD_LENGTH = 5; // Default, will be updated
            let secretWord = '';
            let currentRow = 0;
            let currentCol = 0;
            let guessGrid;

            function initGame() {
                // Select a new word and set its length
                secretWord = wordList[Math.floor(Math.random() * wordList.length)];
                WORD_LENGTH = secretWord.length;

                // Reset state
                currentRow = 0;
                currentCol = 0;
                
                // Dynamic Grid Creation
                drawGrid();
                drawKeyboard();
                
                modal.classList.add('hidden');
            }
            
            function drawGrid() {
                gridContainer.innerHTML = '';
                gridContainer.style.gridTemplateColumns = `repeat(${WORD_LENGTH}, 1fr)`;
                guessGrid = [];

                for (let i = 0; i < GUESS_COUNT; i++) {
                    guessGrid[i] = [];
                    for (let j = 0; j < WORD_LENGTH; j++) {
                        const tile = document.createElement('div');
                        tile.id = `tile-${i}-${j}`;
                        tile.className = 'tile';
                        gridContainer.appendChild(tile);
                        guessGrid[i][j] = '';
                    }
                }
            }

            function drawKeyboard() {
                keyboardContainer.innerHTML = '';
                const keys = [
                    'QWERTYUIOP',
                    'ASDFGHJKL',
                    'ZXCVBNM'
                ];

                keys.forEach(row => {
                    const rowDiv = document.createElement('div');
                    rowDiv.className = 'flex justify-center gap-1';
                    row.split('').forEach(key => {
                        const keyButton = document.createElement('button');
                        keyButton.textContent = key;
                        keyButton.id = `key-${key}`;
                        keyButton.className = 'keyboard-key h-12 flex-1 rounded-md bg-gray-300 font-bold';
                        keyButton.onclick = () => handleKeyPress(key);
                        rowDiv.appendChild(keyButton);
                    });
                    keyboardContainer.appendChild(rowDiv);
                });

                // Special keys row
                const specialRow = document.createElement('div');
                specialRow.className = 'flex justify-center gap-1';
                const enterKey = document.createElement('button');
                enterKey.textContent = 'ENTER';
                enterKey.className = 'keyboard-key h-12 rounded-md bg-gray-400 font-bold px-6';
                enterKey.onclick = handleSubmit;
                const backspaceKey = document.createElement('button');
                backspaceKey.innerHTML = '<i class="fas fa-backspace"></i>';
                backspaceKey.className = 'keyboard-key h-12 rounded-md bg-gray-400 font-bold px-6';
                backspaceKey.onclick = handleBackspace;
                specialRow.append(enterKey, backspaceKey);
                keyboardContainer.appendChild(specialRow);
            }

            function handleKeyPress(key) {
                if (currentCol < WORD_LENGTH) {
                    const tile = document.getElementById(`tile-${currentRow}-${currentCol}`);
                    tile.textContent = key;
                    guessGrid[currentRow][currentCol] = key;
                    currentCol++;
                }
            }
            
            function handleBackspace() {
                if(currentCol > 0) {
                    currentCol--;
                    const tile = document.getElementById(`tile-${currentRow}-${currentCol}`);
                    tile.textContent = '';
                    guessGrid[currentRow][currentCol] = '';
                }
            }

            function handleSubmit() {
                if (currentCol !== WORD_LENGTH) {
                    showMessage("Not enough letters!");
                    return;
                }
                
                const guess = guessGrid[currentRow].join('');
                flipRow(guess);
            }

            function flipRow(guess) {
                const secretFrequency = {};
                for (const letter of secretWord) {
                    secretFrequency[letter] = (secretFrequency[letter] || 0) + 1;
                }

                // First pass for 'correct' letters
                for (let i = 0; i < WORD_LENGTH; i++) {
                    const tile = document.getElementById(`tile-${currentRow}-${i}`);
                    tile.classList.add('flip');
                    if (guess[i] === secretWord[i]) {
                        tile.classList.add('correct');
                        updateKeyboard(guess[i], 'correct');
                        secretFrequency[guess[i]]--;
                    }
                }
                
                // Second pass for 'present' and 'absent' letters
                 for (let i = 0; i < WORD_LENGTH; i++) {
                    const tile = document.getElementById(`tile-${currentRow}-${i}`);
                    if (!tile.classList.contains('correct')) {
                         if (secretWord.includes(guess[i]) && secretFrequency[guess[i]] > 0) {
                            tile.classList.add('present');
                            updateKeyboard(guess[i], 'present');
                            secretFrequency[guess[i]]--;
                        } else {
                            tile.classList.add('absent');
                            updateKeyboard(guess[i], 'absent');
                        }
                    }
                }

                if(guess === secretWord) {
                    setTimeout(() => showMessage("You win!", true), 600);
                } else {
                    currentRow++;
                    currentCol = 0;
                    if (currentRow === GUESS_COUNT) {
                        setTimeout(() => showMessage(`The word was ${secretWord}`, true), 600);
                    }
                }
            }
            
            function updateKeyboard(key, status) {
                 const keyButton = document.getElementById(`key-${key}`);
                 const currentStatus = keyButton.dataset.status;
                 if (currentStatus === 'correct') return;
                 if (currentStatus === 'present' && status === 'absent') return;
                 
                 keyButton.className = `keyboard-key h-12 flex-1 rounded-md font-bold ${status}`;
                 keyButton.dataset.status = status;
            }

            function showMessage(msg, isEndGame = false) {
                messageText.textContent = msg;
                resetButton.style.display = isEndGame ? 'inline-block' : 'none';
                modal.classList.remove('hidden');
                
                if (!isEndGame) {
                    setTimeout(() => modal.classList.add('hidden'), 1500);
                }
            }

            // Keyboard input listener
            window.addEventListener('keydown', (e) => {
                const key = e.key.toUpperCase();
                if (key.length === 1 && key >= 'A' && key <= 'Z') {
                    handleKeyPress(key);
                } else if (key === 'ENTER') {
                    handleSubmit();
                } else if (key === 'BACKSPACE') {
                    handleBackspace();
                }
            });
            
            resetButton.addEventListener('click', initGame);

            // Initialise Game
            initGame();
        });
    </script>
</body>
</html>
