<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patho-Word - Pathology Word Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .nhs-blue { background-color: #005EB8; }
        .nhs-dark-blue { background-color: #003087; }
        .nhs-light-grey { background-color: #F0F4F5; }
        .nhs-text-blue { color: #005EB8; }
        .nhs-text-dark-blue { color: #003087; }

        /* Game Grid Styles */
        .tile {
            width: 60px;
            height: 60px;
            position: relative;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .tile-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            text-transform: uppercase;
            border: 2px solid #d1d5db;
            border-radius: 0.25rem;
        }

        .tile-face.front {
            background-color: white;
        }
        
        .tile-face.front.filled {
             border-color: #6b7280;
        }

        .tile-face.back {
            transform: rotateX(180deg);
        }

        .tile.flip {
            transform: rotateX(180deg);
        }

        /* Color States for the back face */
        .tile-face.back.correct { background-color: #10b981; border-color: #10b981; color: white; } /* Emerald-500 */
        .tile-face.back.present { background-color: #f59e0b; border-color: #f59e0b; color: white; } /* Amber-500 */
        .tile-face.back.absent { background-color: #6b7280; border-color: #6b7280; color: white; } /* Cool-gray-500 */

        /* Shake Animation for Invalid Guess */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .shake {
            animation: shake 0.5s;
        }

        /* Toast Notification */
        #toast {
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s 0.5s, opacity 0.5s;
        }
        #toast.show {
            visibility: visible;
            opacity: 1;
            transition: opacity 0.5s;
        }
        
        /* Hidden input to capture mobile keyboard events */
        #keyboard-input {
            position: absolute;
            top: -9999px;
            left: -9999px;
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-nhs-light-grey text-gray-800 flex flex-col min-h-screen">

    <input type="text" id="keyboard-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />

    <div id="header-placeholder"></div>

    <main class="py-8 flex-grow">
        <div id="game-container" class="container mx-auto px-2 sm:px-4 max-w-lg text-center">
            <a href="games.html" class="inline-flex items-center nhs-text-blue font-semibold mb-4 hover:underline">
                <i data-feather="arrow-left" class="w-4 h-4 mr-2"></i>Back to Games
            </a>
            <h1 class="text-3xl font-bold nhs-text-dark-blue">Patho-Word</h1>
            <p class="text-gray-600 mb-4">Guess the hidden pathology-related word in 6 tries.</p>
            
            <div id="toast" class="fixed top-20 left-1/2 -translate-x-1/2 bg-gray-800 text-white py-2 px-5 rounded-md text-lg font-semibold shadow-lg z-50">
                <span id="toast-message"></span>
            </div>

            <div id="game-grid" class="grid grid-rows-6 gap-1.5 my-6 w-max mx-auto cursor-pointer">
                <!-- Rows and tiles will be generated by JS -->
            </div>
            
            <!-- ADDED: Game over container -->
            <div id="game-over-container" class="hidden mt-6 bg-white p-6 rounded-lg shadow-md">
                <p class="text-lg text-gray-700">The word was:</p>
                <p id="correct-word" class="text-3xl font-bold nhs-text-dark-blue my-2"></p>
                <button id="next-game-btn" class="mt-4 bg-nhs-blue text-white font-bold py-3 px-8 rounded-lg hover:bg-nhs-dark-blue transition duration-300 text-xl">Next Game</button>
            </div>

        </div>
    </main>

    <div id="footer-placeholder"></div>

    <script src="js/component-loader.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const gameGrid = document.getElementById('game-grid');
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            const keyboardInput = document.getElementById('keyboard-input');
            const gameContainer = document.getElementById('game-container');
            const gameOverContainer = document.getElementById('game-over-container');
            const correctWordEl = document.getElementById('correct-word');
            const nextGameBtn = document.getElementById('next-game-btn');


            // --- Game Constants ---
            const WORD_LENGTH = 5;
            const MAX_GUESSES = 6;

            // --- Word Lists ---
            const TARGET_WORDS = [
                'ACUTE', 'ASSAY', 'ATOPY', 'BLOOD', 'CELLS', 'CLOTS', 'CLONE', 'CYSTS', 'DRUGS', 'EDEMA', 'FEVER', 
                'FUNGI', 'GENES', 'GLAND', 'GRAFT', 'HELIX', 'INDEX', 'IONIC', 'KAPPA', 'LIVER', 'LUMEN', 
                'LUPUS', 'LYMPH', 'MEDIA', 'MOLAR', 'MUCUS', 'MYELO', 'NODAL', 'ORGAN', 'PANEL', 'PATCH', 
                'PLATE', 'POLYP', 'RENAL', 'SCANS', 'SERUM', 'SMEAR', 'SPIKE', 'STAFF', 'STAIN', 'STOMA', 
                'SWABS', 'TESTS', 'TOXIC', 'TUMOR', 'ULCER', 'URINE', 'VEINS', 'VIRAL', 'VIRUS', 'VITAL', 
                'WARDS', 'WOUND', 'ALBUM', 'ACID', 'BILE', 'BONE', 'CANCER', 'CARDS', 'CLINIC', 'CODON',
                'COUNT', 'CULTURE', 'CYCLE', 'DISEASE', 'DNA', 'DONOR', 'DOSE', 'ENZYME', 'FACTOR', 'FATTY',
                'FIBRE', 'FIELD', 'FLUID', 'FOCUS', 'FOLATE', 'FORCE', 'FROZEN', 'GAMMA', 'GAUZE', 'GLASS',
                'GRADE', 'GROUP', 'GROWTH', 'HEART', 'HISTO', 'HORMON', 'HOST', 'IMAGE', 'IMMUNE', 'INFECT',
                'INFLAM', 'IODINE', 'IRON', 'ISLET', 'KIDNEY', 'LAB', 'LACTIC', 'LAMBDA', 'LEVEL', 'LIPID',
                'LOBE', 'LUNG', 'MACRO', 'MALIG', 'MARKER', 'MASSS', 'MICRO', 'MIXED', 'MOLEC', 'MORPH',
                'MOUNT', 'MOUSE', 'MUTANT', 'NERVE', 'NORMAL', 'NUCLEI', 'ORDER', 'PAIN', 'PARA', 'PATH',
                'PHAGE', 'PHIAL', 'PHONE', 'PHOTO', 'PIPET', 'PLAIN', 'PLASM', 'POINT', 'POISON', 'POOL',
                'PROBE', 'PUMP', 'PUPIL', 'PURE', 'RACK', 'RADIO', 'RANGE', 'RAPID', 'RATE', 'RATIO', 'AGENT',
                'REACT', 'READ', 'REAGENT', 'RECEPT', 'RECORD', 'RED', 'REPORT', 'RESULT', 'RISK', 'RNA',
                'ROOM', 'ROOT', 'ROUND', 'RULE', 'SAFE', 'SAMPLE', 'SCALE', 'SCAN', 'SCOPE', 'SCORE', 'SCREEN',
                'SECT', 'SENSE', 'SEQUENCE', 'SERA', 'SERIES', 'SHOCK', 'SIDE', 'SIGNAL', 'SITE', 'SIZE',
                'SKIN', 'SLIDE', 'SLOPE', 'SODIUM', 'SOLID', 'SOLUTE', 'SOURCE', 'SPEC', 'SPINAL', 'SPLEEN',
                'SPORE', 'SPOT', 'SQUAM', 'STAGE', 'STEM', 'STERILE', 'STONE', 'STRAIN', 'STRAND', 'STUDY',
                'SUGAR', 'SUITE', 'SURFACE', 'SYNDROME', 'SYSTEM', 'TABLE', 'TARGET', 'TECH', 'TERM', 'THERM',
                'THYMUS', 'THYROID', 'TIME', 'TIP', 'TISSUE', 'TITLE', 'TRACE', 'TRACT', 'TRAY', 'TRIAL',
                'TUBE', 'TYPE', 'UNIT', 'UREA', 'USE', 'VACCINE', 'VALUE', 'VECTOR', 'VIAL', 'VIEW', 'VOLUME',
                'WALL', 'WASTE', 'WATER', 'WAVE', 'WAX', 'WELL', 'WHITE', 'WHOLE', 'XRAY', 'YEAST', 'YIELD',
                'ZINC', 'ZONE', 'ZYGOTE'
            ];

            // --- Game State ---
            let targetWord = '';
            let currentRow = 0;
            let currentTile = 0;
            let isGameOver = false;
            let guesses = Array(MAX_GUESSES).fill(null).map(() => Array(WORD_LENGTH).fill(''));

            // --- Game Logic ---

            function startGame() {
                targetWord = TARGET_WORDS[Math.floor(Math.random() * TARGET_WORDS.length)];
                currentRow = 0;
                currentTile = 0;
                isGameOver = false;
                guesses = Array(MAX_GUESSES).fill(null).map(() => Array(WORD_LENGTH).fill(''));
                
                gameGrid.innerHTML = '';
                gameOverContainer.classList.add('hidden');
                
                for (let i = 0; i < MAX_GUESSES; i++) {
                    const row = document.createElement('div');
                    row.className = 'grid grid-cols-5 gap-1.5';
                    row.id = `row-${i}`;
                    for (let j = 0; j < WORD_LENGTH; j++) {
                        const tile = document.createElement('div');
                        tile.className = 'tile';
                        tile.id = `tile-${i}-${j}`;
                        // FIXED: Create front and back faces for correct flip animation
                        tile.innerHTML = `
                            <div class="tile-face front"></div>
                            <div class="tile-face back"></div>
                        `;
                        row.appendChild(tile);
                    }
                    gameGrid.appendChild(row);
                }
                keyboardInput.focus();
            }

            function handleKeyPress(key) {
                if (isGameOver) return;
                
                const lowerKey = key.toLowerCase();

                if (lowerKey === 'enter') {
                    submitGuess();
                } else if (lowerKey === 'backspace') {
                    deleteLetter();
                } else if (lowerKey.match(/^[a-z]$/)) {
                    addLetter(lowerKey);
                }
            }

            function addLetter(letter) {
                if (currentTile < WORD_LENGTH) {
                    guesses[currentRow][currentTile] = letter;
                    const tileFront = document.getElementById(`tile-${currentRow}-${currentTile}`).querySelector('.front');
                    tileFront.textContent = letter.toUpperCase();
                    tileFront.classList.add('filled');
                    currentTile++;
                }
            }

            function deleteLetter() {
                if (currentTile > 0) {
                    currentTile--;
                    guesses[currentRow][currentTile] = '';
                    const tileFront = document.getElementById(`tile-${currentRow}-${currentTile}`).querySelector('.front');
                    tileFront.textContent = '';
                    tileFront.classList.remove('filled');
                }
            }

            function submitGuess() {
                const guess = guesses[currentRow].join('').toUpperCase();

                if (guess.length !== WORD_LENGTH) {
                    showMessage('Not enough letters');
                    shakeRow();
                    return;
                }
                
                flipTiles(guess);
            }
            
            function flipTiles(guess) {
                const rowEl = document.getElementById(`row-${currentRow}`);
                let correctCount = 0;
                
                for (let i = 0; i < WORD_LENGTH; i++) {
                    const tile = rowEl.children[i];
                    const front = tile.querySelector('.front');
                    const back = tile.querySelector('.back');
                    const letter = guess[i];

                    // Set text on both faces before flipping
                    front.textContent = letter.toUpperCase();
                    back.textContent = letter.toUpperCase();
                    
                    let state = 'absent';
                    if (targetWord[i] === letter) {
                        state = 'correct';
                        correctCount++;
                    } else if (targetWord.includes(letter)) {
                        state = 'present';
                    }
                    
                    setTimeout(() => {
                        back.classList.add(state);
                        tile.classList.add('flip');
                    }, i * 350);
                }

                setTimeout(() => {
                    if (correctCount === WORD_LENGTH) {
                        showMessage('Superb!', 2000);
                        endGame();
                    } else if (currentRow === MAX_GUESSES - 1) {
                        endGame();
                    } else {
                        currentRow++;
                        currentTile = 0;
                    }
                }, WORD_LENGTH * 350);
            }
            
            function endGame() {
                isGameOver = true;
                keyboardInput.blur(); // Hide mobile keyboard
                correctWordEl.textContent = targetWord;
                gameOverContainer.classList.remove('hidden');
            }

            function showMessage(message, duration = 1500) {
                toastMessage.textContent = message;
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, duration);
            }

            function shakeRow() {
                const rowEl = document.getElementById(`row-${currentRow}`);
                rowEl.classList.add('shake');
                rowEl.addEventListener('animationend', () => {
                    rowEl.classList.remove('shake');
                }, { once: true });
            }

            // --- Event Listeners ---
            nextGameBtn.addEventListener('click', startGame);

            keyboardInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === 'Backspace') {
                    e.preventDefault();
                    handleKeyPress(e.key);
                }
            });
             keyboardInput.addEventListener('input', (e) => {
                const typedValue = e.target.value;
                if (typedValue.match(/^[a-zA-Z]$/)) {
                    handleKeyPress(typedValue);
                }
                e.target.value = '';
            });

            gameContainer.addEventListener('click', () => {
                if (!isGameOver) {
                    keyboardInput.focus();
                }
            });

            // --- Initialisation ---
            startGame();
            if (typeof feather !== 'undefined') {
                feather.replace();
            }
        });
    </script>
</body>
</html>
