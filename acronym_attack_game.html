<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab Acronym Attack - SGC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .nhs-blue { background-color: #005EB8; }
        .nhs-dark-blue { background-color: #003087; }
        .nhs-light-grey { background-color: #F0F4F5; }
        .nhs-text-blue { color: #005EB8; }
        .nhs-text-dark-blue { color: #003087; }
        
        #timer-bar {
            transition: width 0.1s linear;
        }
    </style>
</head>
<body class="bg-nhs-light-grey text-gray-800 flex flex-col min-h-screen">

    <div id="header-placeholder"></div>

    <main class="py-12 md:py-16 flex-grow">
        <div class="container mx-auto px-4 sm:px-6 max-w-2xl text-center">
            <a href="games.html" class="inline-flex items-center nhs-text-blue font-semibold mb-8 hover:underline">
                <i data-feather="arrow-left" class="w-4 h-4 mr-2"></i>Back to Games
            </a>
            <h1 class="text-3xl font-bold nhs-text-dark-blue mb-2">Lab Acronym Attack</h1>
            <p class="text-gray-600 mb-8">How many acronyms can you define before the time runs out?</p>

            <div id="game-area" class="bg-white p-6 rounded-lg shadow-lg hidden">
                <div class="w-full bg-gray-200 rounded-full h-4 mb-4">
                    <div id="timer-bar" class="bg-green-500 h-4 rounded-full"></div>
                </div>

                <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 mb-6 rounded-r-lg">
                    <h2 class="text-4xl font-extrabold" id="acronym-display">FBC</h2>
                </div>

                <input type="text" id="answer-input" class="w-full p-4 border-2 border-gray-300 rounded-lg text-xl text-center focus:border-nhs-blue focus:ring-nhs-blue" placeholder="Type the full name...">
                
                <div id="feedback" class="mt-4 font-bold text-2xl h-8"></div>
            </div>
            
            <div id="start-screen" class="bg-white p-6 rounded-lg shadow-lg">
                 <h3 class="text-2xl font-bold nhs-text-dark-blue mb-4">Get Ready!</h3>
                 <p id="start-message" class="text-lg text-gray-700 mb-6">You'll have 30 seconds for each acronym. Type the full name and press Enter to submit your answer.</p>
                 <!-- FIXED: Replaced custom class with standard Tailwind for visibility -->
                 <button id="start-game-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition duration-300 text-xl">Start Game</button>
            </div>

            <div id="game-over-screen" class="bg-white p-6 rounded-lg shadow-lg hidden">
                 <h3 class="text-2xl font-bold text-red-600 mb-4">Time's Up!</h3>
                 <p class="text-lg text-gray-700 mb-6">You correctly defined <span id="final-score" class="font-bold text-2xl nhs-text-dark-blue">0</span> acronyms.</p>
                 <!-- FIXED: Replaced custom class with standard Tailwind for visibility -->
                 <button id="play-again-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition duration-300 text-xl">Play Again</button>
            </div>

        </div>
    </main>

    <div id="footer-placeholder"></div>

    <script src="js/component-loader.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const gameArea = document.getElementById('game-area');
            const startScreen = document.getElementById('start-screen');
            const gameOverScreen = document.getElementById('game-over-screen');
            const acronymDisplay = document.getElementById('acronym-display');
            const answerInput = document.getElementById('answer-input');
            const feedback = document.getElementById('feedback');
            const timerBar = document.getElementById('timer-bar');
            const startGameBtn = document.getElementById('start-game-btn');
            const playAgainBtn = document.getElementById('play-again-btn');
            const finalScoreEl = document.getElementById('final-score');
            const startMessageEl = document.getElementById('start-message');
            
            // --- Game Constants ---
            const INITIAL_ROUND_TIME = 30; // seconds
            const MIN_ROUND_TIME = 5; // The fastest the timer can get
            const ACRONYMS = [
                { ac: 'FBC', name: 'Full Blood Count' }, { ac: 'U&E', name: 'Urea and Electrolytes' }, { ac: 'LFT', name: 'Liver Function Test' },
                { ac: 'CRP', name: 'C-Reactive Protein' }, { ac: 'ESR', name: 'Erythrocyte Sedimentation Rate' }, { ac: 'PT', name: 'Prothrombin Time' },
                { ac: 'APTT', name: 'Activated Partial Thromboplastin Time' }, { ac: 'INR', name: 'International Normalised Ratio' }, { ac: 'TT', name: 'Thrombin Time' },
                { ac: 'G&S', name: 'Group and Save' }, { ac: 'XM', name: 'Crossmatch' }, { ac: 'DAT', name: 'Direct Antiglobulin Test' },
                { ac: 'IAT', name: 'Indirect Antiglobulin Test' }, { ac: 'HbA1c', name: 'Glycated Haemoglobin' }, { ac: 'TSH', name: 'Thyroid Stimulating Hormone' },
                { ac: 'PSA', name: 'Prostate Specific Antigen' }, { ac: 'CK', name: 'Creatine Kinase' }, { ac: 'LDH', name: 'Lactate Dehydrogenase' },
                { ac: 'ALT', name: 'Alanine Aminotransferase' }, { ac: 'AST', name: 'Aspartate Aminotransferase' }, { ac: 'GGT', name: 'Gamma-Glutamyl Transferase' },
                { ac: 'ALP', name: 'Alkaline Phosphatase' }, { ac: 'BNP', name: 'Brain Natriuretic Peptide' }, { ac: 'HCG', name: 'Human Chorionic Gonadotropin' },
                { ac: 'FSH', name: 'Follicle Stimulating Hormone' }, { ac: 'LH', name: 'Luteinising Hormone' }, { ac: 'ACTH', name: 'Adrenocorticotropic Hormone' },
                { ac: 'PTH', name: 'Parathyroid Hormone' }, { ac: 'QC', name: 'Quality Control' }, { ac: 'IQC', name: 'Internal Quality Control' },
                { ac: 'EQA', name: 'External Quality Assurance' }, { ac: 'POCT', name: 'Point of Care Testing' }, { ac: 'HIV', name: 'Human Immunodeficiency Virus' },
                { ac: 'HBV', name: 'Hepatitis B Virus' }, { ac: 'HCV', name: 'Hepatitis C Virus' }, { ac: 'CMV', name: 'Cytomegalovirus' },
                { ac: 'EBV', name: 'Epstein-Barr Virus' }, { ac: 'VZV', name: 'Varicella-Zoster Virus' }, { ac: 'ANA', name: 'Antinuclear Antibody' },
                { ac: 'ANCA', name: 'Anti-Neutrophil Cytoplasmic Antibody' }, { ac: 'dsDNA', name: 'Double-Stranded DNA' }, { ac: 'RF', name: 'Rheumatoid Factor' },
                { ac: 'HLA', name: 'Human Leukocyte Antigen' }, { ac: 'PCR', name: 'Polymerase Chain Reaction' }, { ac: 'DNA', name: 'Deoxyribonucleic Acid' },
                { ac: 'RNA', name: 'Ribonucleic Acid' }, { ac: 'WBC', name: 'White Blood Cell' }, { ac: 'RBC', name: 'Red Blood Cell' },
                { ac: 'PLT', name: 'Platelet' }, { ac: 'HCT', name: 'Haematocrit' }, { ac: 'MCV', name: 'Mean Corpuscular Volume' },
                { ac: 'MCH', name: 'Mean Corpuscular Haemoglobin' }, { ac: 'MCHC', name: 'Mean Corpuscular Haemoglobin Concentration' }, { ac: 'RDW', name: 'Red Cell Distribution Width' },
                { ac: 'MPV', name: 'Mean Platelet Volume' }, { ac: 'ABO', name: 'ABO Blood Group System' }, { ac: 'Rh', name: 'Rhesus Blood Group System' },
                { ac: 'EDTA', name: 'Ethylenediaminetetraacetic Acid' }, { ac: 'SST', name: 'Serum Separator Tube' }, { ac: 'PST', name: 'Plasma Separator Tube' },
                { ac: 'LMWH', name: 'Low Molecular Weight Heparin' }, { ac: 'UFH', name: 'Unfractionated Heparin' }, { ac: 'DOAC', name: 'Direct Oral Anticoagulant' },
                { ac: 'TIBC', name: 'Total Iron Binding Capacity' }, { ac: 'UIBC', name: 'Unsaturated Iron Binding Capacity' }, { ac: 'eGFR', name: 'Estimated Glomerular Filtration Rate' },
                { ac: 'CSF', name: 'Cerebrospinal Fluid' }, { ac: 'AFP', name: 'Alpha-Fetoprotein' }, { ac: 'CEA', name: 'Carcinoembryonic Antigen' },
                { ac: 'TNI', name: 'Troponin I' }, { ac: 'TNT', name: 'Troponin T' }, { ac: 'VMA', name: 'Vanillylmandelic Acid' },
                { ac: 'HVA', name: 'Homovanillic Acid' }, { ac: 'SPEP', name: 'Serum Protein Electrophoresis' }, { ac: 'IFIX', name: 'Immunofixation' },
                { ac: 'SFLC', name: 'Serum Free Light Chains' }, { ac: 'ASOT', name: 'Anti-Streptolysin O Titre' }, { ac: 'TPMT', name: 'Thiopurine Methyltransferase' },
                { ac: 'G6PD', name: 'Glucose-6-Phosphate Dehydrogenase' }, { ac: 'TRALI', name: 'Transfusion Related Acute Lung Injury' }, { ac: 'TACO', name: 'Transfusion Associated Circulatory Overload' },
                { ac: 'FFP', name: 'Fresh Frozen Plasma' }, { ac: 'RCC', name: 'Red Cell Concentrate' }, { ac: 'PCC', name: 'Prothrombin Complex Concentrate' },
                { ac: 'IVIG', name: 'Intravenous Immunoglobulin' }, { ac: 'ADCC', name: 'Antibody-Dependent Cell-Mediated Cytotoxicity' }, { ac: 'ELISA', name: 'Enzyme-Linked Immunosorbent Assay' },
                { ac: 'FISH', name: 'Fluorescence In Situ Hybridization' }, { ac: 'NGS', name: 'Next Generation Sequencing' }, { ac: 'HPLC', name: 'High-Performance Liquid Chromatography' },
                { ac: 'GCMS', name: 'Gas Chromatography-Mass Spectrometry' }, { ac: 'LCMS', name: 'Liquid Chromatography-Mass Spectrometry' }, { ac: 'MALDI-TOF', name: 'Matrix-Assisted Laser Desorption/Ionization Time-of-Flight' }
            ];

            // --- Game State ---
            let score = 0;
            let currentAcronym = {};
            let usedAcronyms = [];
            let timerInterval;
            let currentRoundTime = INITIAL_ROUND_TIME;
            let timeLeft = currentRoundTime;

            // --- Game Logic ---
            function startGame() {
                score = 0;
                usedAcronyms = [];
                currentRoundTime = INITIAL_ROUND_TIME; // Reset timer to initial value
                startMessageEl.textContent = `You'll have ${currentRoundTime} seconds for each acronym. The time will decrease as you get more correct!`;
                startScreen.classList.add('hidden');
                gameOverScreen.classList.add('hidden');
                gameArea.classList.remove('hidden');
                nextRound();
            }

            function nextRound() {
                answerInput.value = '';
                answerInput.disabled = false;
                feedback.textContent = '';
                feedback.className = 'mt-4 font-bold text-2xl h-8';
                
                if (usedAcronyms.length === ACRONYMS.length) {
                    usedAcronyms = []; // Reset if all have been used
                }

                let available = ACRONYMS.filter(a => !usedAcronyms.includes(a.ac));
                currentAcronym = available[Math.floor(Math.random() * available.length)];
                usedAcronyms.push(currentAcronym.ac);

                acronymDisplay.textContent = currentAcronym.ac;
                answerInput.focus();
                startTimer();
            }

            function startTimer() {
                clearInterval(timerInterval);
                timeLeft = currentRoundTime;
                timerBar.style.width = '100%';
                timerBar.classList.remove('bg-yellow-500', 'bg-red-500');
                timerBar.classList.add('bg-green-500');

                timerInterval = setInterval(() => {
                    timeLeft--;
                    const percentage = (timeLeft / currentRoundTime) * 100;
                    timerBar.style.width = `${percentage}%`;

                    if (percentage < 50 && percentage > 25) {
                        timerBar.classList.remove('bg-green-500');
                        timerBar.classList.add('bg-yellow-500');
                    } else if (percentage <= 25) {
                        timerBar.classList.remove('bg-yellow-500');
                        timerBar.classList.add('bg-red-500');
                    }

                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        endGame();
                    }
                }, 1000);
            }

            function checkAnswer() {
                clearInterval(timerInterval);
                answerInput.disabled = true;
                const userAnswer = answerInput.value.trim().toLowerCase();
                const correctAnswer = currentAcronym.name.toLowerCase();

                if (userAnswer === correctAnswer) {
                    score++;
                    // NEW: Decrease timer every 5 correct answers
                    if (score > 0 && score % 5 === 0 && currentRoundTime > MIN_ROUND_TIME) {
                        currentRoundTime -= 5;
                    }
                    feedback.textContent = 'Correct!';
                    feedback.classList.add('text-green-600');
                    setTimeout(nextRound, 1500);
                } else {
                    feedback.textContent = `Incorrect! It's: ${currentAcronym.name}`;
                    feedback.classList.add('text-red-600');
                    setTimeout(endGame, 2500);
                }
            }
            
            function endGame() {
                gameArea.classList.add('hidden');
                gameOverScreen.classList.remove('hidden');
                finalScoreEl.textContent = score;
            }

            // --- Event Listeners ---
            startGameBtn.addEventListener('click', startGame);
            playAgainBtn.addEventListener('click', startGame);
            answerInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    checkAnswer();
                }
            });

            // --- Initialisation ---
            if (typeof feather !== 'undefined') {
                feather.replace();
            }
        });
    </script>
</body>
</html>
